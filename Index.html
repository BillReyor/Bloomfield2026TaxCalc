<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Bloomfield real estate tax calculator for fiscal years 2026-2029" />
  <title>Bloomfield Real Estate Tax Calculator</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 text-gray-900">
  <div class="max-w-4xl mx-auto py-8 px-4">
    <h1 class="text-3xl font-bold text-center mb-6">
      Bloomfield Tax Calculator (FY 2026–FY 2029)
    </h1>

    <p class="mb-8 text-gray-700 leading-relaxed">
      Estimate your residential property taxes over the four-year phase-in after revaluation. Adjust the fields as needed based on your assessment notice.
    </p>

    <div class="bg-white shadow-md rounded-lg p-6 mb-10">
      <h2 class="text-xl font-semibold mb-4 border-b pb-2">Assessed Values</h2>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
          <label for="assessedPre" class="block font-medium mb-1">
            Previous Assessed Value
          </label>
          <input
            type="number"
            id="assessedPre"
            class="w-full p-2 border border-gray-300 rounded"
            aria-describedby="assessedPreHelp"
            placeholder="e.g. 178010"
            value="178010"
          />
          <p id="assessedPreHelp" class="mt-1 text-sm text-gray-500">
            Your property’s assessment before the 2024 revaluation.
          </p>
        </div>

        <div>
          <label for="assessedPost" class="block font-medium mb-1">
            Current Assessed Value
          </label>
          <input
            type="number"
            id="assessedPost"
            class="w-full p-2 border border-gray-300 rounded"
            aria-describedby="assessedPostHelp"
            placeholder="e.g. 244000"
            value="244000"
          />
          <p id="assessedPostHelp" class="mt-1 text-sm text-gray-500">
            Your property’s new assessment after revaluation.
          </p>
        </div>
      </div>

      <hr class="my-6" />

      <h2 class="text-xl font-semibold mb-4 border-b pb-2">Pre-Revaluation Rates</h2>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
        <div>
          <label for="councilMillPre" class="block font-medium mb-1">
            Pre-Reval Council Mill Rate
          </label>
          <input
            type="number"
            id="councilMillPre"
            step="0.01"
            class="w-full p-2 border border-gray-300 rounded"
            aria-describedby="councilMillPreHelp"
            placeholder="e.g. 29.97"
            value="29.97"
          />
          <p id="councilMillPreHelp" class="mt-1 text-sm text-gray-500">
            Tax rate before the 2024 revaluation.
          </p>
        </div>

        <div>
          <label for="equalizedMillPre" class="block font-medium mb-1">
            Pre-Reval Equalized Rate
          </label>
          <input
            type="number"
            id="equalizedMillPre"
            step="0.01"
            class="w-full p-2 border border-gray-300 rounded"
            aria-describedby="equalizedMillPreHelp"
            placeholder="e.g. 27.97"
            value="27.97"
          />
          <p id="equalizedMillPreHelp" class="mt-1 text-sm text-gray-500">
            Rate if the new values were taxed all at once.
          </p>
        </div>

        <div>
          <label for="millRatePre" class="block font-medium mb-1">
            Base Mill Rate (Pre-Reval)
          </label>
          <input
            type="number"
            id="millRatePre"
            step="0.01"
            class="w-full p-2 border border-gray-300 rounded"
            aria-describedby="millRatePreHelp"
            placeholder="e.g. 37.49"
            value="37.49"
          />
          <p id="millRatePreHelp" class="mt-1 text-sm text-gray-500">
            Used to calculate your tax before revaluation.
          </p>
        </div>
      </div>

      <hr class="my-6" />

      <div id="yearRateContainer"></div>

      <hr class="my-6" />

      <div class="mb-4">
        <label for="futureBudgetIncrease" class="block font-medium mb-1">
          Annual Budget Increase
        </label>
        <input
          type="number"
          id="futureBudgetIncrease"
          step="0.001"
          class="w-full p-2 border border-gray-300 rounded"
          aria-describedby="futureBudgetIncreaseHelp"
          placeholder="e.g. 0.03"
          value="0.03"
        />
        <p id="futureBudgetIncreaseHelp" class="mt-1 text-sm text-gray-500">
          Projected annual increase (e.g. 0.03 = 3%).
        </p>
      </div>

      <button
        id="calculateBtn"
        class="w-full bg-blue-600 text-white font-semibold py-3 rounded hover:bg-blue-700 transition"
      >
        Calculate My Taxes
      </button>
    </div>

    <div id="results" class="bg-white shadow-md rounded-lg p-6 space-y-6">
      <!-- Results appear here -->
    </div>
  </div>

  <script>
    const years = [2026, 2027, 2028, 2029];
    const defaultCouncil = [35.64, 34.03, 32.11, 30.45];
    const defaultEqualized = [34.27, 31.88, 29.80, 27.97];
    const container = document.getElementById('yearRateContainer');
    years.forEach((year, idx) => {
      const block = `
        <h2 class="text-xl font-semibold mb-4 border-b pb-2">FY ${year} Rates</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
          <div>
            <label for="councilMillY${idx + 1}" class="block font-medium mb-1">
              Council Mill Rate (FY ${year})
            </label>
            <input type="number" id="councilMillY${idx + 1}" step="0.01" class="w-full p-2 border border-gray-300 rounded" placeholder="e.g. ${defaultCouncil[idx]}" value="${defaultCouncil[idx]}" />
          </div>
          <div>
            <label for="equalizedMillY${idx + 1}" class="block font-medium mb-1">
              Equalized Mill Rate (FY ${year})
            </label>
            <input type="number" id="equalizedMillY${idx + 1}" step="0.01" class="w-full p-2 border border-gray-300 rounded" placeholder="e.g. ${defaultEqualized[idx]}" value="${defaultEqualized[idx]}" />
          </div>
        </div>`;
      container.insertAdjacentHTML('beforeend', block);
    });

    document.getElementById('calculateBtn').addEventListener('click', () => {
      // Parse inputs or default to 0
      const assessedPre      = parseFloat(document.getElementById('assessedPre').value) || 0;
      const assessedPost     = parseFloat(document.getElementById('assessedPost').value) || 0;
      const millRatePre      = parseFloat(document.getElementById('millRatePre').value) || 0;
      const equalizedMillPre = parseFloat(document.getElementById('equalizedMillPre').value) || 0;
      const councilMillPre   = parseFloat(document.getElementById('councilMillPre').value) || 0;
      const futureBudgetIncrease = parseFloat(document.getElementById('futureBudgetIncrease').value) || 0;

      const equalizedMill = years.map((_, i) => parseFloat(document.getElementById(`equalizedMillY${i + 1}`).value) || 0);
      const councilMill   = years.map((_, i) => parseFloat(document.getElementById(`councilMillY${i + 1}`).value) || 0);

      // Calculations
      const propertyValuePre = assessedPre / 0.7;
      const assessedMillPre = assessedPre / 1000;
      const annualTaxPre = assessedMillPre * millRatePre;
      const propertyValuePost = assessedPost / 0.7;
      const changeInAssessment = assessedPost - assessedPre;
      const quarterPhase = changeInAssessment / 4;

      const assessed = years.map((_, i) => assessedPre + quarterPhase * i);
      const assessedMill = assessed.map(v => v / 1000);

      const estRevalPre = assessedMillPre * equalizedMillPre;
      const estReval = [];
      estReval[0] = assessedMill[0] * equalizedMill[0];
      estReval[1] = assessedMill[1] * equalizedMill[1];
      estReval[2] = estReval[1] * (1 + futureBudgetIncrease);
      estReval[3] = estReval[2] * (1 + futureBudgetIncrease);

      const councilPre = assessedMillPre * councilMillPre;
      const council = assessedMill.map((mill, i) => mill * councilMill[i]);

      const incPre = councilPre - annualTaxPre;
      const inc = council.map(val => val - annualTaxPre);
      const monPre = incPre / 12;
      const mon = inc.map(val => val / 12);

      const pctRevalPre = estRevalPre / annualTaxPre - 1;
      const pctReval = [
        estReval[0] / annualTaxPre - 1,
        estReval[1] / annualTaxPre - 1,
        estReval[2] / (assessedMill[2] * millRatePre) - 1,
        estReval[3] / (assessedMill[3] * millRatePre) - 1,
      ];

      const pctTaxPre = incPre / annualTaxPre;
      const pctTax = inc.map(val => val / annualTaxPre);

      const avgInc = assessedPost / assessedPre - 1;
      const property = years.map(() => propertyValuePre * (1 + avgInc));

      const assessedPostArr = assessed.map(v => v + quarterPhase);
      const assessedPostMill = assessedPostArr.map(v => v / 1000);

      const estRevalPost = [];
      estRevalPost[0] = assessedPostMill[0] * equalizedMill[0];
      estRevalPost[1] = assessedPostMill[1] * equalizedMill[1];
      estRevalPost[2] = estRevalPost[1] * (1 + futureBudgetIncrease);
      estRevalPost[3] = estRevalPost[2] * (1 + futureBudgetIncrease);

      const councilPost = assessedPostMill.map((mill, i) => mill * councilMill[i]);

      const resultsEl = document.getElementById('results');
      let html = '';

      function appendLine(label, value) {
        html += `
          <div class="flex justify-between border-b py-1">
            <span class="font-medium text-gray-800">${label}</span>
            <span class="text-gray-700">${value}</span>
          </div>`;
      }

      html += '<div class="text-lg font-semibold mb-2">Before Revaluation</div>';
      appendLine('Property Value Pre', propertyValuePre.toFixed(2));
      appendLine('Assessed Value Pre', assessedPre.toFixed(2));
      appendLine('Assessed Mill Pre', assessedMillPre.toFixed(5));
      appendLine('Mill Rate Pre', millRatePre.toFixed(2));
      appendLine('Tax Pre', annualTaxPre.toFixed(2));

      html += '<div class="mt-4 text-lg font-semibold mb-2">Average Increase</div>';
      appendLine('Avg Increase', (avgInc * 100).toFixed(2) + '%');

      html += '<div class="mt-4 text-lg font-semibold mb-2">After Revaluation</div>';
      appendLine('Property Value Post Prior', propertyValuePost.toFixed(2));
      appendLine('Assessed Value Post Prior', assessedPost.toFixed(2));
      appendLine('Assessed Mill Post Prior', (assessedPost / 1000).toFixed(5));
      appendLine('Equalized Mill Pre', equalizedMillPre.toFixed(2));
      appendLine('Council Mill Pre', councilMillPre.toFixed(2));
      appendLine('Tax Due to Reval Pre', estRevalPre.toFixed(2));
      appendLine('Council Tax Pre', councilPre.toFixed(2));

      html += '<div class="mt-4 text-lg font-semibold mb-2">Tax Increase Pre</div>';
      appendLine('Annual Increase Pre', incPre.toFixed(2));
      appendLine('Monthly Increase Pre', monPre.toFixed(2));
      appendLine('Pct Increase due to Reval Pre', (pctRevalPre * 100).toFixed(2) + '%');
      appendLine('Pct Increase (Tax) Pre', (pctTaxPre * 100).toFixed(2) + '%');

      html += '<div class="mt-4 text-lg font-semibold mb-2">Assessment Change</div>';
      appendLine('Change in Assessment', changeInAssessment.toFixed(2));
      appendLine('One Quarter', quarterPhase.toFixed(2));

      html += '<div class="mt-6 text-xl font-semibold text-gray-800">Yearly Summary</div>';
      html += '<table class="table-auto w-full mt-2">';
      html += '<thead><tr><th class="text-left">Year</th><th class="text-right">Assessed</th><th class="text-right">Council Tax</th><th class="text-right">Annual Inc</th><th class="text-right">Monthly Inc</th></tr></thead><tbody>';
      years.forEach((year, i) => {
        html += `<tr class="border-t"><td>${year}</td><td class="text-right">${assessed[i].toFixed(2)}</td><td class="text-right">${council[i].toFixed(2)}</td><td class="text-right">${inc[i].toFixed(2)}</td><td class="text-right">${mon[i].toFixed(2)}</td></tr>`;
      });
      html += '</tbody></table>';

      resultsEl.innerHTML = html;
    });
  </script>
</body>
</html>
