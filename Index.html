<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Bloomfield Property Tax Estimator</title>
  <!-- Tailwind CSS via CDN for styling -->
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 text-gray-900">
  <!-- Container for content -->
  <div class="max-w-xl mx-auto p-6">
    <!-- Title -->
    <h1 class="text-2xl font-bold text-center mb-4">Bloomfield, CT Property Tax Estimator</h1>
    <!-- Description -->
    <p class="mb-6 text-gray-700">
      Enter your property's assessed value and other details to estimate the annual residential property tax in Bloomfield, Connecticut. 
      This calculator accounts for the 2024 revaluation phase-in and common exemptions. 
      <strong>Note:</strong> Assessed value is 70% of market value, as per Connecticut law.
    </p>
    <!-- Input Form -->
    <div class="bg-white shadow-md rounded p-4 mb-4">
      <!-- Previous Assessed Value -->
      <label for="prevValue" class="block font-medium mb-1">Previous Assessed Value (Pre-Revaluation):</label>
      <input type="number" id="prevValue" class="w-full mb-3 p-2 border border-gray-300 rounded" placeholder="e.g. 140000 (optional)" />
      <!-- New Assessed Value -->
      <label for="newValue" class="block font-medium mb-1">New Assessed Value (Post-Revaluation):</label>
      <input type="number" id="newValue" class="w-full mb-3 p-2 border border-gray-300 rounded" placeholder="e.g. 180000" />
      <!-- Phase-In Year -->
      <label for="phaseYear" class="block font-medium mb-1">Phase-In Year:</label>
      <select id="phaseYear" class="w-full mb-3 p-2 border border-gray-300 rounded">
        <option value="1">Year 1 (25% of increase)</option>
        <option value="2">Year 2 (50% of increase)</option>
        <option value="3">Year 3 (75% of increase)</option>
        <option value="4">Year 4 (100% - full value)</option>
      </select>
      <!-- Mill Rates -->
      <label for="townMill" class="block font-medium mb-1">Town Mill Rate:</label>
      <input type="number" id="townMill" class="w-full mb-3 p-2 border border-gray-300 rounded" placeholder="e.g. 35.64" step="0.01" />
      <label for="fireMill" class="block font-medium mb-1">Fire District Mill Rate:</label>
      <input type="number" id="fireMill" class="w-full mb-3 p-2 border border-gray-300 rounded" placeholder="e.g. 2.50 (if applicable)" step="0.01" />
      <!-- Exemptions -->
      <label for="exemptions" class="block font-medium mb-1">Total Exemptions/Deductions (Assessed Value):</label>
      <input type="number" id="exemptions" class="w-full mb-4 p-2 border border-gray-300 rounded" placeholder="e.g. 3000 (veteran exemption, etc)" />
      <!-- Calculate Button -->
      <button id="calcBtn" class="w-full bg-blue-600 text-white font-semibold py-2 rounded hover:bg-blue-700">Calculate Tax</button>
    </div>
    <!-- Result Display -->
    <div id="result" class="text-lg font-medium text-blue-800"></div>
  </div>

  <!-- JavaScript for calculation -->
  <script>
    // Get form elements by their IDs
    const prevInput = document.getElementById('prevValue');
    const newInput = document.getElementById('newValue');
    const yearSelect = document.getElementById('phaseYear');
    const townMillInput = document.getElementById('townMill');
    const fireMillInput = document.getElementById('fireMill');
    const exemptionsInput = document.getElementById('exemptions');
    const resultDiv = document.getElementById('result');
    const calcBtn = document.getElementById('calcBtn');
    
    // Default mill rates for convenience (update these defaults as needed when mill rates change)
    townMillInput.value = 35.64;  // Example: Bloomfield FY2026 town mill rate
    fireMillInput.value = 0;      // Default to 0 (if no separate fire district, adjust if needed)
    
    // Calculation function
    function calculateTax() {
      // Parse input values
      const prevVal = parseFloat(prevInput.value) || 0;
      const newVal = parseFloat(newInput.value);
      const phaseYear = parseInt(yearSelect.value);
      const townMill = parseFloat(townMillInput.value) || 0;
      const fireMill = parseFloat(fireMillInput.value) || 0;
      const exemptions = parseFloat(exemptionsInput.value) || 0;
      
      // Validate that a new assessed value was entered
      if (isNaN(newVal) || newVal <= 0) {
        resultDiv.textContent = "Please enter a valid new assessed value.";
        return;
      }
      
      // Determine effective assessed value, accounting for phase-in if applicable
      let effectiveAssessed = newVal;
      if (prevVal > 0 && prevVal !== newVal) {
        // Calculate phased-in assessed value for the selected phase-in year
        const increase = newVal - prevVal;
        const fraction = phaseYear / 4;  // 4-year phase-in: 0.25 for year 1, 0.5 for year 2, etc.
        effectiveAssessed = prevVal + increase * fraction;
        // If the phase-in schedule changes in the future, adjust the fraction formula accordingly.
      }
      
      // Subtract exemptions from assessed value (but not below zero)
      let netAssessed = effectiveAssessed - exemptions;
      if (netAssessed < 0) netAssessed = 0;
      
      // Calculate property tax = (net assessed value * total mill rate) / 1000
      const totalMillRate = townMill + fireMill;
      const estimatedTax = (netAssessed * totalMillRate) / 1000;
      
      // Display the result, formatted to two decimal places like currency
      resultDiv.textContent = 
        "Estimated Annual Property Tax: $" + estimatedTax.toFixed(2) + 
        (exemptions > 0 ? " (after exemptions)" : "");
    }
    
    // Run calculation when the "Calculate" button is clicked
    calcBtn.addEventListener('click', calculateTax);
  </script>
</body>
</html>
