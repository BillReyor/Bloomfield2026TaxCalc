<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Bloomfield real estate tax calculator for fiscal years 2026-2029" />
  <meta name="author" content="Created by William Reyor" />
  <title>Bloomfield Real Estate Tax Calculator</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 text-gray-900">
  <div class="max-w-3xl mx-auto py-8 px-4">
    <h1 class="text-3xl font-bold text-center mb-6">
      Bloomfield Tax Calculator (FY 2026–FY 2029)
    </h1>

    <p class="mb-6 text-gray-700 leading-relaxed">
      Enter your property’s assessed value (after the October 2024 revaluation) to see your estimated annual taxes for the next four years. 
      For more detailed options (phase-in rates, historical values, etc.), expand “Advanced Configuration.”
    </p>

    <!-- Simple Input Section -->
    <div class="bg-white shadow-md rounded-lg p-6 mb-6">
      <h2 class="text-xl font-semibold mb-4 border-b pb-2">Assessed Value</h2>
      <div>
        <label for="assessedCurrent" class="block font-medium mb-1">
          Current Assessed Value
        </label>
        <input
          type="number"
          id="assessedCurrent"
          class="w-full p-2 border border-gray-300 rounded"
          placeholder="e.g. 244000"
          value="244000"
          aria-describedby="assessedCurrentHelp"
        />
        <p id="assessedCurrentHelp" class="mt-1 text-sm text-gray-500">
          Your property’s assessment effective for FY 2026 (after revaluation).
        </p>
      </div>
    </div>

    <!-- Advanced Configuration Toggle -->
    <button
      id="toggleAdvanced"
      aria-expanded="false"
      aria-controls="advancedConfig"
      class="mb-6 text-blue-600 hover:text-blue-800 font-medium focus:outline-none"
    >
      Advanced Configuration ▼
    </button>

    <!-- Advanced Configuration Section (hidden by default) -->
    <div
      id="advancedConfig"
      class="hidden transition-all duration-200 bg-white shadow-md rounded-lg p-6 mb-6 space-y-6"
    >
      <h2 class="text-xl font-semibold mb-4 border-b pb-2">Advanced Rates & Options</h2>

      <div>
        <h3 class="text-lg font-semibold mb-2">Rates Before 2024 Revaluation</h3>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
          <div>
            <label for="councilMillPre" class="block font-medium mb-1">
              Council Mill Rate (Before)
            </label>
            <input
              type="number"
              id="councilMillPre"
              step="0.01"
              class="w-full p-2 border border-gray-300 rounded"
              placeholder="e.g. 29.97"
              value="29.97"
              aria-describedby="councilMillPreHelp"
            />
            <p id="councilMillPreHelp" class="mt-1 text-sm text-gray-500">
              Town Council’s tax rate (mills) before October 2024.
            </p>
          </div>

          <div>
            <label for="equalizedMillPre" class="block font-medium mb-1">
              Equalized Rate (Before)
            </label>
            <input
              type="number"
              id="equalizedMillPre"
              step="0.01"
              class="w-full p-2 border border-gray-300 rounded"
              placeholder="e.g. 27.97"
              value="27.97"
              aria-describedby="equalizedMillPreHelp"
            />
            <p id="equalizedMillPreHelp" class="mt-1 text-sm text-gray-500">
              Comparative rate if re-valued values applied immediately.
            </p>
          </div>

          <div>
            <label for="millRatePre" class="block font-medium mb-1">
              Base Mill Rate (Before)
            </label>
            <input
              type="number"
              id="millRatePre"
              step="0.01"
              class="w-full p-2 border border-gray-300 rounded"
              placeholder="e.g. 37.49"
              value="37.49"
              aria-describedby="millRatePreHelp"
            />
            <p id="millRatePreHelp" class="mt-1 text-sm text-gray-500">
              Used to calculate tax on the old assessed value.
            </p>
          </div>
        </div>
      </div>

      <hr />

      <div>
        <h3 class="text-lg font-semibold mb-2">FY 2026 Rates</h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <label for="councilMillY1" class="block font-medium mb-1">
              Council Mill Rate (FY 2026)
            </label>
            <input
              type="number"
              id="councilMillY1"
              step="0.01"
              class="w-full p-2 border border-gray-300 rounded"
              placeholder="e.g. 35.64"
              value="35.64"
              aria-describedby="councilMillY1Help"
            />
            <p id="councilMillY1Help" class="mt-1 text-sm text-gray-500">
              Tax rate (mills) adopted for fiscal year 2026.
            </p>
          </div>

          <div>
            <label for="equalizedMillY1" class="block font-medium mb-1">
              Equalized Rate (FY 2026)
            </label>
            <input
              type="number"
              id="equalizedMillY1"
              step="0.01"
              class="w-full p-2 border border-gray-300 rounded"
              placeholder="e.g. 34.27"
              value="34.27"
              aria-describedby="equalizedMillY1Help"
            />
            <p id="equalizedMillY1Help" class="mt-1 text-sm text-gray-500">
              Fully phased-in comparison rate for FY 2026.
            </p>
          </div>
        </div>
      </div>

      <hr />

      <div>
        <h3 class="text-lg font-semibold mb-2">FY 2027 Rates</h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <label for="councilMillY2" class="block font-medium mb-1">
              Council Mill Rate (FY 2027)
            </label>
            <input
              type="number"
              id="councilMillY2"
              step="0.01"
              class="w-full p-2 border border-gray-300 rounded"
              placeholder="e.g. 34.03"
              value="34.03"
              aria-describedby="councilMillY2Help"
            />
            <p id="councilMillY2Help" class="mt-1 text-sm text-gray-500">
              Tax rate (mills) adopted for fiscal year 2027.
            </p>
          </div>

          <div>
            <label for="equalizedMillY2" class="block font-medium mb-1">
              Equalized Rate (FY 2027)
            </label>
            <input
              type="number"
              id="equalizedMillY2"
              step="0.01"
              class="w-full p-2 border border-gray-300 rounded"
              placeholder="e.g. 31.88"
              value="31.88"
              aria-describedby="equalizedMillY2Help"
            />
            <p id="equalizedMillY2Help" class="mt-1 text-sm text-gray-500">
              Fully phased-in comparison rate for FY 2027.
            </p>
          </div>
        </div>
      </div>

      <hr />

      <div>
        <h3 class="text-lg font-semibold mb-2">FY 2028 Rates</h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <label for="councilMillY3" class="block font-medium mb-1">
              Council Mill Rate (FY 2028)
            </label>
            <input
              type="number"
              id="councilMillY3"
              step="0.01"
              class="w-full p-2 border border-gray-300 rounded"
              placeholder="e.g. 32.11"
              value="32.11"
              aria-describedby="councilMillY3Help"
            />
            <p id="councilMillY3Help" class="mt-1 text-sm text-gray-500">
              Tax rate (mills) adopted for fiscal year 2028.
            </p>
          </div>

          <div>
            <label for="equalizedMillY3" class="block font-medium mb-1">
              Equalized Rate (FY 2028)
            </label>
            <input
              type="number"
              id="equalizedMillY3"
              step="0.01"
              class="w-full p-2 border border-gray-300 rounded"
              placeholder="e.g. 29.80"
              value="29.80"
              aria-describedby="equalizedMillY3Help"
            />
            <p id="equalizedMillY3Help" class="mt-1 text-sm text-gray-500">
              Fully phased-in comparison rate for FY 2028.
            </p>
          </div>
        </div>
      </div>

      <hr />

      <div>
        <h3 class="text-lg font-semibold mb-2">FY 2029 Rates</h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <label for="councilMillY4" class="block font-medium mb-1">
              Council Mill Rate (FY 2029)
            </label>
            <input
              type="number"
              id="councilMillY4"
              step="0.01"
              class="w-full p-2 border border-gray-300 rounded"
              placeholder="e.g. 30.45"
              value="30.45"
              aria-describedby="councilMillY4Help"
            />
            <p id="councilMillY4Help" class="mt-1 text-sm text-gray-500">
              Tax rate (mills) adopted for fiscal year 2029.
            </p>
          </div>

          <div>
            <label for="equalizedMillY4" class="block font-medium mb-1">
              Equalized Rate (FY 2029)
            </label>
            <input
              type="number"
              id="equalizedMillY4"
              step="0.01"
              class="w-full p-2 border border-gray-300 rounded"
              placeholder="e.g. 27.97"
              value="27.97"
              aria-describedby="equalizedMillY4Help"
            />
            <p id="equalizedMillY4Help" class="mt-1 text-sm text-gray-500">
              Fully phased-in comparison rate for FY 2029.
            </p>
          </div>
        </div>
      </div>

      <hr />

      <div>
        <h3 class="text-lg font-semibold mb-2">Annual Budget Increase</h3>
        <div>
          <label for="futureBudgetIncrease" class="block font-medium mb-1">
            Projected Increase Rate
          </label>
          <input
            type="number"
            id="futureBudgetIncrease"
            step="0.001"
            class="w-full p-2 border border-gray-300 rounded"
            placeholder="e.g. 0.03"
            value="0.03"
            aria-describedby="futureBudgetIncreaseHelp"
          />
          <p id="futureBudgetIncreaseHelp" class="mt-1 text-sm text-gray-500">
            Enter as a decimal (0.03 = 3%). Used for FY 2028 & FY 2029.
          </p>
        </div>
      </div>
    </div>

    <!-- Calculate Button -->
    <button
      id="calculateBtn"
      class="w-full bg-blue-600 text-white font-semibold py-3 rounded hover:bg-blue-700 transition mb-8"
      disabled
    >
      Calculate My Taxes
    </button>

    <!-- Results Section -->
    <div id="results" class="bg-white shadow-md rounded-lg p-6 space-y-4">
      <!-- Outputs will be injected here -->
    </div>
  </div>

  <script>
    // Cache DOM references
    const assessedCurrentInput = document.getElementById('assessedCurrent');
    const toggleAdvancedBtn    = document.getElementById('toggleAdvanced');
    const advancedConfigDiv    = document.getElementById('advancedConfig');
    const calculateBtn         = document.getElementById('calculateBtn');
    const resultsEl            = document.getElementById('results');

    // Advanced inputs
    const councilMillY1Input      = document.getElementById('councilMillY1');
    const councilMillY2Input      = document.getElementById('councilMillY2');
    const councilMillY3Input      = document.getElementById('councilMillY3');
    const councilMillY4Input      = document.getElementById('councilMillY4');
    const futureBudgetIncreaseInput = document.getElementById('futureBudgetIncrease');

    // Default rate values for FY2026–FY2029
    const defaultRates = {
      councilY1: 35.64,
      councilY2: 34.03,
      councilY3: 32.11,
      councilY4: 30.45,
      futureIncrease: 0.03
    };

    // Validate the assessed value input and enable/disable calculate button
    function validateInput() {
      const val = parseFloat(assessedCurrentInput.value);
      if (!isNaN(val) && val > 0) {
        calculateBtn.disabled = false;
      } else {
        calculateBtn.disabled = true;
      }
    }

    assessedCurrentInput.addEventListener('input', validateInput);
    // Run initial validation on load
    validateInput();

    // Toggle advanced configuration visibility
    toggleAdvancedBtn.addEventListener('click', () => {
      const isHidden = advancedConfigDiv.classList.contains('hidden');
      if (isHidden) {
        advancedConfigDiv.classList.remove('hidden');
        toggleAdvancedBtn.textContent = 'Hide Advanced Configuration ▲';
        toggleAdvancedBtn.setAttribute('aria-expanded', 'true');
      } else {
        advancedConfigDiv.classList.add('hidden');
        toggleAdvancedBtn.textContent = 'Advanced Configuration ▼';
        toggleAdvancedBtn.setAttribute('aria-expanded', 'false');
      }
    });

    // Helper: format numbers with commas and two decimals
    function formatCurrency(num) {
      return Number(num.toFixed(2)).toLocaleString('en-US', {
        minimumFractionDigits: 2,
        maximumFractionDigits: 2
      });
    }

    // Helper: render results into the DOM
    function renderResults(taxValues) {
      // taxValues = [taxY1, taxY2, taxY3, taxY4]
      const [taxY1, taxY2, taxY3, taxY4] = taxValues;
      // Calculate year-over-year differences
      const diffY2 = taxY2 - taxY1;
      const pctY2  = diffY2 / taxY1 * 100;
      const diffY3 = taxY3 - taxY2;
      const pctY3  = diffY3 / taxY2 * 100;
      const diffY4 = taxY4 - taxY3;
      const pctY4  = diffY4 / taxY3 * 100;

      resultsEl.innerHTML = `
        <div class="text-lg font-semibold mb-2">Estimated Annual Taxes</div>
        <div class="grid grid-cols-1 gap-2">
          <div class="flex justify-between border-b py-1">
            <span class="font-medium text-gray-800">FY 2026</span>
            <span class="text-gray-700">$${formatCurrency(taxY1)}</span>
          </div>
          <div class="flex justify-between border-b py-1">
            <span class="font-medium text-gray-800">FY 2027</span>
            <span class="text-gray-700">$${formatCurrency(taxY2)}</span>
          </div>
          <div class="flex justify-between border-b py-1">
            <span class="font-medium text-gray-800">FY 2028</span>
            <span class="text-gray-700">$${formatCurrency(taxY3)}</span>
          </div>
          <div class="flex justify-between border-b py-1">
            <span class="font-medium text-gray-800">FY 2029</span>
            <span class="text-gray-700">$${formatCurrency(taxY4)}</span>
          </div>
        </div>

        <div class="mt-6 text-lg font-semibold mb-2">Year-Over-Year Changes</div>
        <div class="grid grid-cols-1 gap-2">
          <div class="flex justify-between border-b py-1">
            <span class="text-gray-800">FY 2027 vs FY 2026</span>
            <span class="text-gray-700">
              $${formatCurrency(diffY2)} (${pctY2.toFixed(1)}%)
            </span>
          </div>
          <div class="flex justify-between border-b py-1">
            <span class="text-gray-800">FY 2028 vs FY 2027</span>
            <span class="text-gray-700">
              $${formatCurrency(diffY3)} (${pctY3.toFixed(1)}%)
            </span>
          </div>
          <div class="flex justify-between border-b py-1">
            <span class="text-gray-800">FY 2029 vs FY 2028</span>
            <span class="text-gray-700">
              $${formatCurrency(diffY4)} (${pctY4.toFixed(1)}%)
            </span>
          </div>
        </div>
      `;
    }

    // Main calculation logic
    calculateBtn.addEventListener('click', () => {
      const assessedCurrent = parseFloat(assessedCurrentInput.value) || 0;
      const advancedVisible = !advancedConfigDiv.classList.contains('hidden');

      let { councilY1, councilY2, councilY3, councilY4, futureIncrease } = defaultRates;

      if (advancedVisible) {
        councilY1      = parseFloat(councilMillY1Input.value) || councilY1;
        councilY2      = parseFloat(councilMillY2Input.value) || councilY2;
        councilY3      = parseFloat(councilMillY3Input.value) || councilY3;
        councilY4      = parseFloat(councilMillY4Input.value) || councilY4;
        futureIncrease = parseFloat(futureBudgetIncreaseInput.value) || futureIncrease;
      }

      const assessedMillCurrent = assessedCurrent / 1000;

      const taxY1 = assessedMillCurrent * councilY1;
      const taxY2 = assessedMillCurrent * councilY2;
      const taxY3 = assessedMillCurrent * councilY3 * (1 + futureIncrease);
      const taxY4 = assessedMillCurrent * councilY4 * (1 + futureIncrease);

      renderResults([taxY1, taxY2, taxY3, taxY4]);
    });
  </script>
</body>
</html>
